{"version":3,"file":"vue.js","sources":["../src/observe/arr.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 监听数组变异方法（修改数组本身）  7个\n\nlet oldArrayPrototype = Array.prototype;\nexport let newArrayPrototype = Object.create(oldArrayPrototype);\n\nconst methods = [\n  \"push\",\n  \"shift\",\n  \"pop\",\n  \"unshift\",\n  \"reserve\",\n  \"sort\",\n  \"splice\",\n];\nmethods.forEach((method) => {\n  newArrayPrototype[method] = function (...args) {\n    let result = oldArrayPrototype[method].call(this, ...args); // 函数劫持   切片编程\n    let inserted;\n    let ob = this.__ob__;\n    switch (method) {\n      case \"push\":\n      case \"unshift\":\n        inserted = args;\n        break;\n      case \"splice\":\n        inserted = args.slice(2);\n      default:\n        break;\n    }\n    ob.observeArr(inserted);\n    return result;\n  };\n});\n","import { newArrayPrototype } from \"./arr\";\n\nclass Observe {\n  constructor(data) {\n    Object.defineProperty(data, \"__ob__\", {\n      value: this,\n      enumerable: false,\n    });\n    if (Array.isArray(data)) {\n      // 保留原数组特性并重写部分方法\n      data.__proto__ = newArrayPrototype;\n      this.observeArr(data); // 数组中放有对象，继续监控对象变化\n    } else {\n      this.walk(data);\n    }\n  }\n  walk(data) {\n    // Object.defineProperty 只能劫持已经存在的属性\n    // 重新定义属性\n    Object.keys(data).forEach((key) => defineReactive(data, key, data[key]));\n  }\n  observeArr(data) {\n    data.forEach((item) => observe(item));\n  }\n}\n// 闭包 value  //属性劫持\nfunction defineReactive(target, key, value) {\n  observe(value);\n  Object.defineProperty(target, key, {\n    get() {\n      // 取值的时候\n      return value;\n    },\n    set(newValue) {\n      // 设置 修改值\n      if (value === newValue) return;\n      observe(newValue);\n      value = newValue;\n    },\n  });\n}\nexport function observe(data) {\n  if (typeof data !== \"object\" || data === null) return;\n  // 如果一个对象被劫持了，就不需要劫持了，可以增加一个实例，实例来判断是否被劫持过\n  if (data.__ob__ instanceof Observe) {\n    return data.__ob__;\n  }\n  return new Observe(data);\n}\n","import { observe } from \"./observe/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.data) {\n    initDate(vm);\n  }\n}\nfunction proxy(vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[target][key];\n    },\n    set(newValue) {\n      vm[target][key] = newValue;\n    },\n  });\n}\nfunction initDate(vm) {\n  let data = vm.$options.data;\n  data = typeof data === \"function\" ? data.call(vm) : data;\n  vm._data = data;\n  for (let key in data) {\n    proxy(vm, \"_data\", key);\n  }\n  observe(data);\n}\n","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    let vm = this;\n    vm.$options = options; // 将 用户的选项配置 挂到vm实例上\n    initState(vm);\n  };\n}\n","import { initMixin } from \"./init\";\n\nfunction Vue(options) {\n  this._init(options);\n}\n\ninitMixin(Vue);\nexport default Vue;\n"],"names":["oldArrayPrototype","Array","prototype","newArrayPrototype","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","slice","observeArr","Observe","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","set","newValue","initState","vm","opts","$options","initDate","proxy","_data","initMixin","Vue","_init","options"],"mappings":"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"}